---
/**
 * AuthorProfile component - displays user profile card
 * Uses shared render functions for consistency with FullPreview
 */
import type {
  IProfile,
  IDatabaseAccount,
  IGlobalProperties,
  IAccountManabars,
} from '../../lib/blog-logic'
import type { CardLayout, SocialLink } from '../types'
import {
  createAuthorProfileData,
  createAuthorProfileSettings,
  renderAuthorProfileSections,
  renderSocialLinks,
} from '../../../shared/components/author-profile'

interface Props {
  username: string
  account: IDatabaseAccount | null
  profile: IProfile | null
  globalProperties: IGlobalProperties | null
  accountManabars: IAccountManabars | null
  // Layout from settings
  profileLayout?: CardLayout
  // Size settings
  avatarSize?: number
  coverHeight?: number
  usernameSize?: number
  displayNameSize?: number
  aboutSize?: number
  statsSize?: number
  metaSize?: number
  // Social Links
  socialLinks?: SocialLink[]
}

const {
  username,
  account,
  profile,
  globalProperties,
  accountManabars,
  profileLayout,
  avatarSize,
  coverHeight,
  usernameSize,
  displayNameSize,
  aboutSize,
  statsSize,
  metaSize,
  socialLinks = []
} = Astro.props

// Create normalized data using shared utility
const profileData = createAuthorProfileData(
  username,
  profile,
  account,
  globalProperties,
  accountManabars
)

// Create settings using shared utility
const profileSettings = createAuthorProfileSettings({
  authorProfileLayout2: profileLayout,
  authorAvatarSizePx: avatarSize,
  authorCoverHeightPx: coverHeight,
  authorUsernameSizePx: usernameSize,
  authorDisplayNameSizePx: displayNameSize,
  authorAboutSizePx: aboutSize,
  authorStatsSizePx: statsSize,
  authorMetaSizePx: metaSize,
  socialLinks,
})

// Render using shared functions
const sectionsHtml = renderAuthorProfileSections(profileData, profileSettings)
const socialLinksHtml = renderSocialLinks(profileSettings.socialLinks)
---

<div class="bg-bg-card rounded-xl shadow-sm border border-border overflow-hidden p-4">
  <div class="space-y-2" set:html={sectionsHtml} />
  {socialLinksHtml && <Fragment set:html={socialLinksHtml} />}
</div>
