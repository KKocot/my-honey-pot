---
interface NavigationTab {
  id: string
  label: string
  enabled: boolean
  showCount: boolean
  href?: string
  tooltip?: string
}

interface Props {
  activeTab?: string
  postsCount?: number
  commentsCount?: number
  navigationTabs?: NavigationTab[]
}

const { activeTab = 'posts', postsCount, commentsCount, navigationTabs } = Astro.props

interface NavItem {
  id: string
  label: string
  count?: number
  href?: string
  external?: boolean
  disabled?: boolean
  tooltip?: string
}

// Build nav items from settings or use defaults
function buildNavItems(): NavItem[] {
  if (navigationTabs && navigationTabs.length > 0) {
    return navigationTabs
      .filter(tab => tab.enabled)
      .map(tab => {
        const isExternal = tab.href && (tab.href.startsWith('http://') || tab.href.startsWith('https://'))
        const count = tab.showCount
          ? (tab.id === 'posts' ? postsCount : tab.id === 'comments' ? commentsCount : undefined)
          : undefined

        // Threads are work in progress
        const isDisabled = tab.id === 'threads'

        return {
          id: tab.id,
          label: tab.label,
          count,
          href: tab.href,
          external: isExternal,
          disabled: isDisabled,
          tooltip: isDisabled ? 'Work in Progress' : tab.tooltip,
        }
      })
  }

  // Fallback to defaults
  return [
    { id: 'posts', label: 'Posts', count: postsCount },
    { id: 'comments', label: 'Comments', count: commentsCount },
  ]
}

const navItems = buildNavItems()

function buildHref(item: NavItem): string {
  if (item.external && item.href) {
    return item.href
  }
  if (item.id === 'posts') {
    return '/'
  }
  return `/?tab=${item.id}`
}
---

<nav class="border-b border-border mb-6">
  <div class="flex flex-wrap">
    {navItems.map(item => {
      const isActive = item.id === activeTab
      const href = buildHref(item)

      return item.disabled ? (
        <div
          class="relative px-4 py-3 text-sm font-medium text-text-muted/50 cursor-not-allowed group"
          title={item.tooltip}
        >
          <span class="flex items-center gap-2">
            {item.label}
            {item.count !== undefined && (
              <span class="text-xs px-1.5 py-0.5 rounded-full bg-bg text-text-muted/50">
                {item.count}
              </span>
            )}
          </span>
          {/* Tooltip on hover */}
          {item.tooltip && (
            <span class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 text-xs bg-bg-card border border-border rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">
              {item.tooltip}
            </span>
          )}
        </div>
      ) : item.external ? (
        <a
          href={href}
          target="_blank"
          rel="noopener noreferrer"
          class={`
            relative px-4 py-3 text-sm font-medium transition-colors
            hover:bg-bg-card/50
            ${isActive ? 'text-text' : 'text-text-muted hover:text-text'}
          `}
        >
          <span class="flex items-center gap-2">
            {item.label}
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
            </svg>
          </span>
        </a>
      ) : (
        <a
          href={href}
          class={`
            relative px-4 py-3 text-sm font-medium transition-colors
            hover:bg-bg-card/50
            ${isActive ? 'text-text' : 'text-text-muted hover:text-text'}
          `}
          data-tab={item.id}
        >
          <span class="flex items-center gap-2">
            {item.label}
            {item.count !== undefined && (
              <span class={`
                text-xs px-1.5 py-0.5 rounded-full
                ${isActive ? 'bg-primary/10 text-primary' : 'bg-bg text-text-muted'}
              `}>
                {item.count}
              </span>
            )}
          </span>
          {isActive && (
            <span class="absolute bottom-0 left-0 right-0 h-1 bg-primary rounded-t-full" />
          )}
        </a>
      )
    })}
  </div>
</nav>
