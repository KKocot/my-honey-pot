---
/**
 * BlogLogicPostCard - uses shared PostCard utilities
 * Supports both sections layout and legacy flags
 */
import type { Post } from '../../lib/blog-logic'
import type { CardLayout } from '../../shared/components/post-card'
import {
  createPostCardDataFromPost,
  createPostCardSettings,
  renderPostCard,
} from '../../shared/components/post-card'

interface Props {
  post: Post
  cardLayout: 'horizontal' | 'vertical'
  thumbnailPosition: 'left' | 'right'
  thumbnailSizePx: number
  cardPaddingPx: number
  cardBorderRadiusPx: number
  titleSizePx: number
  showThumbnail: boolean
  showSummary: boolean
  summaryMaxLength: number
  showDate: boolean
  showVotes: boolean
  showComments: boolean
  showPayout: boolean
  showTags: boolean
  cardBorder: boolean
  maxTags: number
  masonryStyle?: string
  // Optional sections layout for drag & drop
  postCardLayout?: CardLayout
  // Hover effect settings
  cardHoverEffect?: 'none' | 'shadow' | 'lift' | 'scale' | 'glow'
  cardTransitionDuration?: number
  cardHoverScale?: number
  cardHoverShadow?: string
  cardHoverBrightness?: number
}

const {
  post,
  cardLayout,
  thumbnailPosition,
  thumbnailSizePx,
  cardPaddingPx,
  cardBorderRadiusPx,
  titleSizePx,
  showThumbnail,
  showSummary,
  summaryMaxLength,
  showDate,
  showVotes,
  showComments,
  showPayout,
  showTags,
  cardBorder,
  maxTags,
  masonryStyle = '',
  postCardLayout,
  cardHoverEffect,
  cardTransitionDuration,
  cardHoverScale,
  cardHoverShadow,
  cardHoverBrightness,
} = Astro.props

// Create normalized post data using shared utility
const postData = await createPostCardDataFromPost(post, {
  thumbnailSizePx,
  maxTags,
  summaryMaxLength,
})

// Create settings using shared utility
const cardSettings = createPostCardSettings({
  cardLayout,
  thumbnailPosition,
  thumbnailSizePx,
  cardPaddingPx,
  cardBorderRadiusPx,
  titleSizePx,
  showThumbnail,
  showSummary,
  summaryMaxLength,
  showDate,
  showVotes,
  showComments,
  showPayout,
  showTags,
  cardBorder,
  maxTags,
  postCardLayout,
  cardHoverEffect,
  cardTransitionDuration,
  cardHoverScale,
  cardHoverShadow,
  cardHoverBrightness,
})

// Render using shared function
const isVertical = cardLayout === 'vertical'
const postCardHtml = renderPostCard(postData, cardSettings, isVertical, `/${post.permlink}`, masonryStyle)
---

<Fragment set:html={postCardHtml} />
