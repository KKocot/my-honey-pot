---
import type { Post } from '../../lib/blog-logic'
import type { SiteSettings } from './types'
import BlogLogicPostCard from './BlogLogicPostCard.astro'

interface Props {
  posts: Post[]
  settings: SiteSettings
}

const { posts, settings } = Astro.props

// Settings with defaults - ensure we use the exact values from admin settings
const postsLayout = settings.postsLayout || 'list'
const gridColumns = settings.gridColumns || 2
const cardGapPx = settings.cardGapPx ?? 24
// Force vertical layout for grid/masonry (matching FullPreview behavior)
const cardLayout = postsLayout !== 'list' ? 'vertical' : (settings.cardLayout || 'horizontal')
const thumbnailPosition = settings.thumbnailPosition || 'left'
// Use explicit defaults matching admin/types.ts defaultSettings
const thumbnailSizePx = settings.thumbnailSizePx ?? 96
const cardPaddingPx = settings.cardPaddingPx ?? 24
const cardBorderRadiusPx = settings.cardBorderRadiusPx ?? 16
const titleSizePx = settings.titleSizePx ?? 20
const showThumbnail = settings.showThumbnail !== false
const showSummary = settings.showSummary !== false
const summaryMaxLength = settings.summaryMaxLength ?? 150
const showDate = settings.showDate !== false
const showVotes = settings.showVotes !== false
const showComments = settings.showComments !== false
const showPayout = settings.showPayout !== false
const showTags = settings.showTags !== false
const cardBorder = settings.cardBorder !== false
const maxTags = settings.maxTags ?? 5
// Get postCardLayout for sections-based rendering (if available)
const postCardLayout = settings.postCardLayout
// Hover effect settings
const cardHoverEffect = settings.cardHoverEffect || 'none'
const cardTransitionDuration = settings.cardTransitionDuration ?? 200
const cardHoverScale = settings.cardHoverScale ?? 1.02
const cardHoverShadow = settings.cardHoverShadow ?? 'lg'
const cardHoverBrightness = settings.cardHoverBrightness ?? 1.05

function getContainerStyle(): string {
  if (postsLayout === 'list') {
    return `display: flex; flex-direction: column; gap: ${cardGapPx}px;`
  } else if (postsLayout === 'grid') {
    return `display: grid; grid-template-columns: repeat(${gridColumns}, 1fr); gap: ${cardGapPx}px;`
  } else {
    return `column-count: ${gridColumns}; column-gap: ${cardGapPx}px;`
  }
}

function getMasonryStyle(): string {
  return postsLayout === 'masonry' ? `break-inside: avoid; margin-bottom: ${cardGapPx}px;` : ''
}
---

<div style={getContainerStyle()}>
  {posts.map((post) => (
    <BlogLogicPostCard
      post={post}
      cardLayout={cardLayout}
      thumbnailPosition={thumbnailPosition}
      thumbnailSizePx={thumbnailSizePx}
      cardPaddingPx={cardPaddingPx}
      cardBorderRadiusPx={cardBorderRadiusPx}
      titleSizePx={titleSizePx}
      showThumbnail={showThumbnail}
      showSummary={showSummary}
      summaryMaxLength={summaryMaxLength}
      showDate={showDate}
      showVotes={showVotes}
      showComments={showComments}
      showPayout={showPayout}
      showTags={showTags}
      cardBorder={cardBorder}
      maxTags={maxTags}
      masonryStyle={getMasonryStyle()}
      postCardLayout={postCardLayout}
      cardHoverEffect={cardHoverEffect}
      cardTransitionDuration={cardTransitionDuration}
      cardHoverScale={cardHoverScale}
      cardHoverShadow={cardHoverShadow}
      cardHoverBrightness={cardHoverBrightness}
    />
  ))}
</div>
