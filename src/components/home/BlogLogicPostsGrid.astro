---
import type { Post } from '../../lib/blog-logic'
import type { SiteSettings } from './types'
import BlogLogicPostCard from './BlogLogicPostCard.astro'

interface Props {
  posts: Post[]
  settings: SiteSettings
}

const { posts, settings } = Astro.props

// Layout settings
const postsLayout = settings.postsLayout || 'list'
const gridColumns = settings.gridColumns || 2
const cardGapPx = settings.cardGapPx ?? 24

// Card settings with defaults
const thumbnailSizePx = settings.thumbnailSizePx ?? 96
const cardPaddingPx = settings.cardPaddingPx ?? 24
const cardBorderRadiusPx = settings.cardBorderRadiusPx ?? 16
const titleSizePx = settings.titleSizePx ?? 20
const summaryMaxLength = settings.summaryMaxLength ?? 150
const cardBorder = settings.cardBorder !== false
const maxTags = settings.maxTags ?? 5

// postCardLayout is required for sections-based rendering
const postCardLayout = settings.postCardLayout

// Hover effect settings
const cardHoverEffect = settings.cardHoverEffect || 'none'
const cardTransitionDuration = settings.cardTransitionDuration ?? 200
const cardHoverScale = settings.cardHoverScale ?? 1.02
const cardHoverShadow = settings.cardHoverShadow ?? 'lg'
const cardHoverBrightness = settings.cardHoverBrightness ?? 1.05

function getContainerStyle(): string {
  if (postsLayout === 'list') {
    return `display: flex; flex-direction: column; gap: ${cardGapPx}px;`
  } else if (postsLayout === 'grid') {
    return `display: grid; grid-template-columns: repeat(${gridColumns}, 1fr); gap: ${cardGapPx}px;`
  } else {
    return `column-count: ${gridColumns}; column-gap: ${cardGapPx}px;`
  }
}

function getMasonryStyle(): string {
  return postsLayout === 'masonry' ? `break-inside: avoid; margin-bottom: ${cardGapPx}px;` : ''
}
---

<div style={getContainerStyle()}>
  {posts.map((post) => (
    <BlogLogicPostCard
      post={post}
      thumbnailSizePx={thumbnailSizePx}
      cardPaddingPx={cardPaddingPx}
      cardBorderRadiusPx={cardBorderRadiusPx}
      titleSizePx={titleSizePx}
      summaryMaxLength={summaryMaxLength}
      cardBorder={cardBorder}
      maxTags={maxTags}
      masonryStyle={getMasonryStyle()}
      postCardLayout={postCardLayout}
      cardHoverEffect={cardHoverEffect}
      cardTransitionDuration={cardTransitionDuration}
      cardHoverScale={cardHoverScale}
      cardHoverShadow={cardHoverShadow}
      cardHoverBrightness={cardHoverBrightness}
    />
  ))}
</div>
