---
import Layout from '../layouts/Layout.astro'
import { AdminPanel } from '../components/admin'
import { loadConfigFromHive } from '../components/admin/hive-broadcast'
import type { SettingsData } from '../components/admin/types'

// Load initial settings from Hive on server
let initialSettings: SettingsData | null = null
// import.meta.env works in dev, process.env works in production SSR
const hiveUsername = import.meta.env.HIVE_USERNAME || process.env.HIVE_USERNAME

if (hiveUsername) {
  try {
    console.log(`Admin: Loading config from Hive for @${hiveUsername}...`)
    const config = await loadConfigFromHive(hiveUsername)
    if (config) {
      console.log('Admin: Loaded config from Hive!')
      initialSettings = config as SettingsData
    }
  } catch (e) {
    console.warn('Admin: Failed to load config from Hive:', e)
  }
}
---

<Layout title="Admin Panel - Hive Blog">
  <div class="max-w-7xl mx-auto px-4 py-8">
    <a
      href="/"
      class="inline-flex items-center text-primary hover:text-primary-hover mb-6 transition-colors"
    >
      <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
      Back to site
    </a>

    <h1 class="text-3xl font-bold text-text mb-8">Admin Panel</h1>

    <AdminPanel client:only="solid-js" initialSettings={initialSettings} />
  </div>
</Layout>
