---
import '../styles/global.css'
import { getPayloadClient } from '../lib/payload'
import { themePresets, type ThemeColors } from '../components/admin/types'

interface Props {
  title: string
}

interface SiteSettings {
  siteTheme?: string
  customColors?: ThemeColors | null
  siteName?: string
  siteDescription?: string
}

const { title } = Astro.props

// Default to light theme colors
let themeColors: ThemeColors = themePresets[0].colors

try {
  const payload = await getPayloadClient()
  const settings = await payload.findGlobal({
    slug: 'settings',
  }) as SiteSettings

  // Use custom colors if available, otherwise find preset
  if (settings.customColors) {
    themeColors = settings.customColors
  } else {
    const preset = themePresets.find((p) => p.id === (settings.siteTheme || 'light'))
    if (preset) {
      themeColors = preset.colors
    }
  }
} catch {
  // Keep default (light) theme colors
}

// Build inline style string for CSS variables
const themeStyle = `
  --theme-bg: ${themeColors.bg};
  --theme-bg-secondary: ${themeColors.bgSecondary};
  --theme-bg-card: ${themeColors.bgCard};
  --theme-text: ${themeColors.text};
  --theme-text-muted: ${themeColors.textMuted};
  --theme-primary: ${themeColors.primary};
  --theme-primary-hover: ${themeColors.primaryHover};
  --theme-primary-text: ${themeColors.primaryText};
  --theme-accent: ${themeColors.accent};
  --theme-border: ${themeColors.border};
  --theme-success: ${themeColors.success};
  --theme-error: ${themeColors.error};
  --theme-warning: ${themeColors.warning};
  --theme-info: ${themeColors.info};
`
---

<!doctype html>
<html lang="pl" style={themeStyle}>
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
  </head>
  <body class="bg-bg text-text min-h-screen transition-colors duration-300">
    <slot />
  </body>
</html>
